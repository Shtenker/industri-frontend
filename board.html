<table>
  <thead>
    <tr>
      <th>Order ID</th>
      <th>Line #</th>
      <th>Product ID</th>
      <th>Product Name</th>
    </tr>
  </thead>
  <tbody id="ordersTableBody"></tbody>
</table>

<script>
async function fetchAndRenderOrders() {
  try {
    const productsResponse = await fetch("https://industri-backend.onrender.com/products");
    const products = await productsResponse.json();

    const productMap = {};
    products.forEach(p => {
      productMap[p.articleNumber] = p.name;
    });

    const ordersResponse = await fetch("https://industri-backend.onrender.com/orders");
    const orders = await ordersResponse.json();

    const grouped = {};
    orders.forEach(({ order_id, product_id, line_number }) => {
      if (!grouped[order_id]) grouped[order_id] = [];
      grouped[order_id].push({ product_id, line_number });
    });

    const tableBody = document.getElementById("ordersTableBody");
    tableBody.innerHTML = "";

    Object.entries(grouped).forEach(([orderId, items]) => {
      items.sort((a, b) => a.line_number - b.line_number);

      items.forEach((item, idx) => {
        const row = document.createElement("tr");

        if (idx === 0) {
          const orderCell = document.createElement("td");
          orderCell.textContent = orderId;
          orderCell.rowSpan = items.length;
          row.appendChild(orderCell);
        }

        const lineCell = document.createElement("td");
        lineCell.textContent = item.line_number;

        const idCell = document.createElement("td");
        idCell.textContent = item.product_id;

        const productCell = document.createElement("td");
        productCell.textContent = productMap[item.product_id] || "Unknown product";

        row.appendChild(lineCell);
        row.appendChild(idCell);
        row.appendChild(productCell);

        tableBody.appendChild(row);
      });
    });
  } catch (error) {
    console.error("Failed to load or render orders:", error);
  }
}

fetchAndRenderOrders();
</script>